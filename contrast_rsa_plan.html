<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contrast RSA Integration Plan for rMVPA • rMVPA</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Contrast RSA Integration Plan for rMVPA"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">rMVPA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="articles/index.html">Articles</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Contrast RSA Integration Plan for rMVPA</h1>

    </div>

<div id="contrast-rsa-integration-plan-for-rmvpa" class="section level1">

<p>This document outlines the steps to integrate the Multi-Dimensional Signed Representational Voxel Encoding (MS-ReVE) approach into the <code>rMVPA</code> package, primarily through a new <code>contrast_rsa_model</code>.</p>
<p>** Always check off the items that are done. ** Conceptual plan in in signed_rsa_proposal.md</p>
<div class="section level2">
<h2 id="phase-1-core-model-implementation">Phase 1: Core Model Implementation<a class="anchor" aria-label="anchor" href="#phase-1-core-model-implementation"></a></h2>
<ul class="task-list"><li>
<label><input type="checkbox"><strong>Create <code>msreve_design</code> Object:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Define a new S3/S4 class <code>msreve_design</code>.</label></li>
<li><label><input type="checkbox">Include slots for the underlying <code>mvpa_design</code> object.</label></li>
<li><label><input type="checkbox">Include a slot for the user-defined <code>contrast_matrix</code> (<code>C</code>, <code>K x Q</code>).</label></li>
<li><label><input type="checkbox">Document the class and its purpose.</label></li>
<li><label><input type="checkbox">(Optional) Add helper function <code>orthogonalize_contrasts(C)</code> for users.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Develop <code>compute_crossvalidated_means_sl</code> Helper Function:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Input: <code>mvpa_dataset</code> subset for the searchlight (<code>sl_data</code>), <code>mvpa_design</code>, <code>cv_spec</code>, <code>estimation_method</code> parameter.</label></li>
<li><label><input type="checkbox">The <code>cv_spec</code> object is generated by the user from functions in <code>R/crossval.R</code> (e.g., <code>blocked_cross_validation(mvpa_design$block_var)</code>), defining the specific CV strategy.</label></li>
<li><label><input type="checkbox">Implement logic to compute <code>K x V_sl</code> matrix <code>Û_sl</code> based on cross-validation folds defined in <code>cv_spec</code> (using helpers like <code><a href="reference/train_indices.html">train_indices()</a></code> and <code><a href="reference/get_nfolds.html">get_nfolds()</a></code>).</label></li>
<li><label><input type="checkbox">Support different <code>estimation_method</code>s (e.g., “average_betas”, potentially others later).</label></li>
<li><label><input type="checkbox">Add unit tests for this function.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Create <code>contrast_rsa_model</code> Specification:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Define a new S3 class <code>contrast_rsa_model</code> (inheriting from <code>mvpa_model_spec</code> which itself inherits from <code>model_spec</code>).</label></li>
<li>
<label><input type="checkbox">Write the constructor <code>contrast_rsa_model(...)</code>.</label>
<ul class="task-list"><li><label><input type="checkbox"><strong>Crucially, this constructor must use <code>create_model_spec("contrast_rsa_model", ...)</code> internally to properly instantiate the model object.</strong></label></li>
<li><label><input type="checkbox">Takes <code>mvpa_dataset</code>.</label></li>
<li><label><input type="checkbox">Takes an <code>msreve_design</code> object.</label></li>
<li><label><input type="checkbox">Takes parameters: <code>estimation_method</code>, <code>regression_type</code>, <code>output_metric</code>.</label></li>
</ul></li>
<li><label><input type="checkbox">Add documentation and examples for the constructor.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Implement <code>train_model.contrast_rsa_model</code> Method:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Input: <code>obj</code> (<code>contrast_rsa_model</code>), <code>sl_data</code>, <code>sl_info</code> (containing center voxel index/ID).</label></li>
<li><label><input type="checkbox"><strong>Step 1:</strong> Call <code>compute_crossvalidated_means_sl</code> to get <code>Û_sl</code>.</label></li>
<li><label><input type="checkbox"><strong>Step 2:</strong> Compute <code>Ĝ_sl = Û_sl %*% t(Û_sl)</code>.</label></li>
<li>
<label><input type="checkbox"><strong>Step 3:</strong> Prepare RSA regression inputs:</label>
<ul class="task-list"><li><label><input type="checkbox">Vectorize <code>Ĝ_sl</code> (<code>dvec_sl</code>).</label></li>
<li><label><input type="checkbox">Create predictor matrix <code>X_sl</code> from <code>obj$design$contrast_matrix</code>. (Reuse/adapt <code>rsa_model_mat</code> logic). Handle <code>block_var</code> exclusions if necessary.</label></li>
</ul></li>
<li><label><input type="checkbox"><strong>Step 4:</strong> Run regression (using <code>obj$regression_type</code>) to get <code>β_sl</code> (Q-vector). Reuse <code>run_lm</code>, <code>run_lm_constrained</code>, etc.</label></li>
<li><label><input type="checkbox"><strong>Step 5:</strong> Compute <code>Δ_sl = t(Û_sl) %*% C</code> (<code>V_sl x Q</code> matrix).</label></li>
<li><label><input type="checkbox"><strong>Step 6:</strong> Extract center voxel’s projection <code>Δ_{v_c,sl}</code> (Q-vector) using <code>sl_info</code>.</label></li>
<li><label><input type="checkbox"><strong>Step 7:</strong> Calculate the final <code>result_vector</code> based on <code>obj$output_metric</code> (e.g., <code>β_sl * Δ_{v_c,sl}</code>).</label></li>
<li><label><input type="checkbox"><strong>Step 8:</strong> Return the named <code>result_vector</code> (Q-dimensional).</label></li>
<li><label><input type="checkbox">Add robust error handling within the function.</label></li>
<li><label><input type="checkbox">Add unit tests for this method (mocking dependencies).</label></li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="phase-2-searchlight-integration">Phase 2: Searchlight Integration<a class="anchor" aria-label="anchor" href="#phase-2-searchlight-integration"></a></h2>
<ul class="task-list"><li>
<label><input type="checkbox"><strong>Update Searchlight Machinery:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Ensure the searchlight generation code (volume and surface) makes the center voxel’s index/ID available in the <code>sl_info</code> object passed to the iterator function.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Create Iterator Function <code>msreve_iterate</code>:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Input: <code>model_spec</code> (<code>contrast_rsa_model</code>), <code>slight</code> (list of searchlights), <code>cind</code> (center indices).</label></li>
<li><label><input type="checkbox">Iterate through searchlights.</label></li>
<li><label><input type="checkbox">Extract data (<code>sl_data</code>) and center voxel info (<code>sl_info</code>) for each searchlight.</label></li>
<li><label><input type="checkbox">Call <code>train_model.contrast_rsa_model(model_spec, sl_data, sl_info, ...)</code></label></li>
<li><label><input type="checkbox">Collect results (Q-vectors) and error status into a standard data frame format compatible with combiners.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Create Combiner Function <code>combine_msreve_standard</code>:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Input: <code>model_spec</code>, <code>good_results</code>, <code>bad_results</code>.</label></li>
<li><label><input type="checkbox">Extract center voxel IDs from <code>good_results$id</code>.</label></li>
<li><label><input type="checkbox">Extract the list of Q-vectors from <code>good_results$performance</code>.</label></li>
<li><label><input type="checkbox">Bind these vectors into an <code>N_voxels x Q</code> matrix.</label></li>
<li><label><input type="checkbox">Create <code>Q</code> separate output maps (e.g., <code>SparseNeuroVec</code> or <code>NeuroSurfaceVector</code>), one per column (contrast). Name them appropriately.</label></li>
<li><label><input type="checkbox">Ensure output maps (layers) are named based on contrast names.</label></li>
<li><label><input type="checkbox">Return a result object (e.g., <code>msreve_searchlight_result</code>) containing the list of these <code>Q</code> maps.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Implement <code>run_searchlight.contrast_rsa_model</code> S3 Method:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Define the method signature.</label></li>
<li><label><input type="checkbox">Call <code>run_searchlight_base</code> internally.</label></li>
<li><label><input type="checkbox">Pass <code>mvpa_fun = msreve_iterate</code>.</label></li>
<li><label><input type="checkbox">Pass <code>combiner = combine_msreve_standard</code>.</label></li>
<li><label><input type="checkbox">Handle method-specific arguments if necessary (e.g., currently only supporting “standard” method).</label></li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="phase-3-documentation--testing">Phase 3: Documentation &amp; Testing<a class="anchor" aria-label="anchor" href="#phase-3-documentation--testing"></a></h2>
<ul class="task-list"><li>
<label><input type="checkbox"><strong>Add Vignette/Tutorial:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Create a new vignette demonstrating how to use <code>contrast_rsa_model</code>.</label></li>
<li><label><input type="checkbox">Include example data setup, model definition, execution, and interpretation of results.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Comprehensive Integration Tests:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Write tests covering the end-to-end workflow for both volume and surface data.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>Refine Documentation:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Ensure all new functions and classes have clear Roxygen documentation.</label></li>
<li><label><input type="checkbox">Update relevant sections of the package README or overview documentation.</label></li>
</ul></li>
<li>
<label><input type="checkbox"><strong>(Optional) Implement <code>run_regional.contrast_rsa_model</code>:</strong></label>
<ul class="task-list"><li><label><input type="checkbox">Wrap <code>train_model.contrast_rsa_model</code> for ROI-based analysis (analogous to other <code>run_regional</code> methods).</label></li>
<li><label><input type="checkbox">Consider if a custom <code>process_roi.contrast_rsa_model</code> method is needed if whole-ROI processing differs significantly from searchlight processing beyond what <code>train_model</code> can handle.</label></li>
</ul></li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

