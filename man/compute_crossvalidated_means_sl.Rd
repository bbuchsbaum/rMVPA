% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_cv_means.R
\name{compute_crossvalidated_means_sl}
\alias{compute_crossvalidated_means_sl}
\title{Compute Cross-Validated Condition Means within a Searchlight}
\usage{
compute_crossvalidated_means_sl(
  sl_data,
  mvpa_design,
  cv_spec,
  estimation_method = "average",
  whitening_matrix_W = NULL,
  return_folds = FALSE
)
}
\arguments{
\item{sl_data}{A numeric matrix (samples x voxels/vertices) containing the data
for the current searchlight.}

\item{mvpa_design}{The \code{mvpa_design} object associated with the dataset,
containing condition labels and block information.}

\item{cv_spec}{An object describing the cross-validation scheme, typically created
by functions like \code{\\link{blocked_cross_validation}}, \code{\\link{twofold_blocked_cross_validation}},
\code{\\link{kfold_cross_validation}}, etc. (inheriting from \code{cross_validation}).
This object determines how training/test folds are defined.}

\item{estimation_method}{Character string specifying the method to estimate means.
Currently supported: \code{"average"} (simple mean of training samples per condition).
\itemize{
  \item \code{"average"}: Simple mean of training samples per condition.
  \item \code{"L2_norm"}: Identical to \code{"average"} but each condition pattern (row) is finally scaled to unit L2 norm. Useful when you need to equalise overall pattern energy across conditions before RSA.
  \item \code{"crossnobis"}: Applies a pre-computed whitening matrix (see `whitening_matrix_W`) to the average pattern of each condition within each cross-validation training fold, before averaging these whitened patterns across folds. This aims to produce noise-normalized condition representations.
}
Default is \code{"average"}.}

\item{whitening_matrix_W}{Optional V x V numeric matrix, where V is the number of voxels/features in `sl_data`. 
This matrix should be the whitening transformation (e.g., Î£_noise^(-1/2)) derived from GLM residuals.
Required and used only if `estimation_method = "crossnobis"`.}

\item{return_folds}{Logical, if TRUE, the function returns a list containing both the
overall mean estimate (`mean_estimate`) and an array of per-fold estimates (`fold_estimates`).
If FALSE (default), only the overall mean estimate is returned.}
}
\value{
If `return_folds = FALSE` (default): A numeric matrix (K x V_sl) where K is the number of 
  conditions and V_sl is the number of voxels/vertices in the searchlight. Each row 
  represents the cross-validated mean pattern for condition k.
  If `return_folds = TRUE`: A list with two elements:
  \describe{
    \item{`mean_estimate`}{The K x V_sl matrix described above.}
    \item{`fold_estimates`}{A K x V_sl x M array, where M is the number of folds,
      containing the mean estimate for each condition from each fold.}
  }
}
\description{
This helper function calculates the mean activation pattern for each condition
using data from other cross-validation folds.
}
\keyword{internal}
