<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cross-Validation Strategies in rMVPA • rMVPA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cross-Validation Strategies in rMVPA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rMVPA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cross-Validation Strategies in rMVPA</h1>
                        <h4 data-toc-skip class="author">Bradley
Buchsbaum</h4>
            
            <h4 data-toc-skip class="date">2025-09-27</h4>
      

      <div class="d-none name"><code>CrossValidation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Cross-validation is a critical component in evaluating the
performance and generalizability of MVPA models. The <code>rMVPA</code>
package provides several cross-validation strategies specifically
designed for neuroimaging data, where temporal structure and run/block
organization must be carefully considered.</p>
<p>This vignette covers: - The importance of cross-validation in MVPA -
Available cross-validation schemes - How to implement each scheme - Best
practices and considerations - Working examples</p>
</div>
<div class="section level2">
<h2 id="cross-validation-fundamentals">Cross-Validation Fundamentals<a class="anchor" aria-label="anchor" href="#cross-validation-fundamentals"></a>
</h2>
<div class="section level3">
<h3 id="why-cross-validation-matters-in-mvpa">Why Cross-Validation Matters in MVPA<a class="anchor" aria-label="anchor" href="#why-cross-validation-matters-in-mvpa"></a>
</h3>
<p>Cross-validation is essential in neuroimaging analyses. It gives us
unbiased estimates of how well our models perform and shows whether
brain activity patterns truly generalize to new data. By separating
training and test sets, cross-validation prevents us from overfitting to
noise in the data. It also maintains temporal independence between sets,
which is crucial for time-series neuroimaging data.</p>
</div>
<div class="section level3">
<h3 id="available-cross-validation-schemes">Available Cross-Validation Schemes<a class="anchor" aria-label="anchor" href="#available-cross-validation-schemes"></a>
</h3>
<p>The <code>rMVPA</code> package implements several cross-validation
strategies:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Blocked Cross-Validation</strong>: Uses scanning runs as
natural validation blocks</li>
<li>
<strong>K-Fold Cross-Validation</strong>: Randomly partitions data
into k folds</li>
<li>
<strong>Bootstrap Blocked Cross-Validation</strong>: Resamples
within blocks with replacement</li>
<li>
<strong>Sequential Blocked Cross-Validation</strong>: Creates
sequential folds within blocks</li>
<li>
<strong>Two-Fold Blocked Cross-Validation</strong>: Splits blocks
into two groups</li>
<li>
<strong>Custom Cross-Validation</strong>: Allows user-defined
validation schemes</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="blocked-cross-validation">Blocked Cross-Validation<a class="anchor" aria-label="anchor" href="#blocked-cross-validation"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>Blocked cross-validation is the most common approach for fMRI data.
It respects the temporal structure of the data by using scanning runs as
natural validation blocks.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a simple blocked structure: 5 runs with 20 trials each</span></span>
<span><span class="va">block_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">cval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">blocked_cross_validation</a></span><span class="op">(</span><span class="va">block_var</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cval</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Blocked Cross-Validation ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Dataset Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">100</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Number of Folds: </span> <span style="color: #00BB00;">5</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Block Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Total Blocks: </span> <span style="color: #00BB00;">5</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #0000BB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #0000BB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Block Sizes: </span> <span style="color: #00BB00;">1: 20, 2: 20, 3: 20, 4: 20, 5: 20</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="implementation-example">Implementation Example<a class="anchor" aria-label="anchor" href="#implementation-example"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate example data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,  <span class="co"># 100 trials total</span></span>
<span>  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  x3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 5 conditions</span></span>
<span></span>
<span><span class="co"># Generate cross-validation samples</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crossval_samples.html">crossval_samples</a></span><span class="op">(</span><span class="va">cval</span>, <span class="va">dat</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">##   ytrain       ytest        train               test                .id  </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;fct [80]&gt;</span>   <span style="color: #949494;">&lt;fct [20]&gt;</span>   <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 01   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;fct [80]&gt;</span>   <span style="color: #949494;">&lt;fct [20]&gt;</span>   <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 02   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">&lt;fct [80]&gt;</span>   <span style="color: #949494;">&lt;fct [20]&gt;</span>   <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 03   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> <span style="color: #949494;">&lt;fct [80]&gt;</span>   <span style="color: #949494;">&lt;fct [20]&gt;</span>   <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 04   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> <span style="color: #949494;">&lt;fct [80]&gt;</span>   <span style="color: #949494;">&lt;fct [20]&gt;</span>   <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 05</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="understanding-the-output">Understanding the Output<a class="anchor" aria-label="anchor" href="#understanding-the-output"></a>
</h3>
<p>Each row in the samples tibble contains: - <code>ytrain</code>:
Training labels - <code>ytest</code>: Test labels - <code>train</code>:
Training data subset - <code>test</code>: Test data subset -
<code>.id</code>: Fold identifier</p>
</div>
</div>
<div class="section level2">
<h2 id="bootstrap-blocked-cross-validation">Bootstrap Blocked Cross-Validation<a class="anchor" aria-label="anchor" href="#bootstrap-blocked-cross-validation"></a>
</h2>
<div class="section level3">
<h3 id="overview-1">Overview<a class="anchor" aria-label="anchor" href="#overview-1"></a>
</h3>
<p>This method combines blocking with bootstrap resampling, providing
more stable performance estimates while respecting the run
structure.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create bootstrap blocked CV with 20 repetitions</span></span>
<span><span class="va">boot_cval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">bootstrap_blocked_cross_validation</a></span><span class="op">(</span><span class="va">block_var</span>, nreps <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">boot_cval</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Bootstrap Blocked Cross-Validation ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Configuration</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">100</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Bootstrap Repetitions: </span> <span style="color: #00BB00;">20</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Block Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Total Blocks: </span> <span style="color: #00BB00;">5</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #0000BB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #0000BB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Block Sizes: </span> <span style="color: #00BB00;">1: 20, 2: 20, 3: 20, 4: 20, 5: 20</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Sampling Weights</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Status: </span> <span style="color: #BB0000;">None</span>  (uniform sampling)</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate samples</span></span>
<span><span class="va">boot_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crossval_samples.html">crossval_samples</a></span><span class="op">(</span><span class="va">boot_cval</span>, <span class="va">dat</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">boot_samples</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 100 × 5</span></span></span>
<span><span class="co">##    ytrain     ytest      train               test                .id  </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 001  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 002  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 003  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 004  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 005  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 006  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 007  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 008  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 009  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;fct [80]&gt;</span> <span style="color: #949494;">&lt;fct [20]&gt;</span> <span style="color: #949494;">&lt;resample [80 x 3]&gt;</span> <span style="color: #949494;">&lt;resample [20 x 3]&gt;</span> 010  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="optional-weighted-sampling">Optional Weighted Sampling<a class="anchor" aria-label="anchor" href="#optional-weighted-sampling"></a>
</h3>
<p>You can provide weights to influence the sampling probability:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create weights (e.g., based on motion parameters)</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">block_var</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">weighted_boot_cval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">bootstrap_blocked_cross_validation</a></span><span class="op">(</span></span>
<span>  <span class="va">block_var</span>, </span>
<span>  nreps <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  weights <span class="op">=</span> <span class="va">weights</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">weighted_boot_cval</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Bootstrap Blocked Cross-Validation ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Configuration</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">100</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Bootstrap Repetitions: </span> <span style="color: #00BB00;">20</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Block Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Total Blocks: </span> <span style="color: #00BB00;">5</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #0000BB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #0000BB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Block Sizes: </span> <span style="color: #00BB00;">1: 20, 2: 20, 3: 20, 4: 20, 5: 20</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Sampling Weights</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Status: </span> <span style="color: #00BB00;">Present</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Range: </span> <span style="color: #00BB00;">[0.001, 0.020]</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Non-zero Weights: </span> <span style="color: #00BB00;">100</span> <span style="color: #0000BB; font-style: italic;"> (</span> <span style="color: #00BB00;">100.0%</span> <span style="color: #0000BB; font-style: italic;">)</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="sequential-blocked-cross-validation">Sequential Blocked Cross-Validation<a class="anchor" aria-label="anchor" href="#sequential-blocked-cross-validation"></a>
</h2>
<div class="section level3">
<h3 id="overview-2">Overview<a class="anchor" aria-label="anchor" href="#overview-2"></a>
</h3>
<p>This method creates sequential folds within each block, useful when
temporal order matters.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create sequential blocked CV with 2 folds and 4 repetitions</span></span>
<span><span class="va">seq_cval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">sequential_blocked_cross_validation</a></span><span class="op">(</span></span>
<span>  <span class="va">block_var</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  nreps <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seq_cval</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $block_var</span></span>
<span><span class="co">##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span></span>
<span><span class="co">##  [38] 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4</span></span>
<span><span class="co">##  [75] 4 4 4 4 4 4 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $nfolds</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $nreps</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $block_ind</span></span>
<span><span class="co">## [1] 1 2 3 4 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "sequential_blocked_cross_validation" "cross_validation"                   </span></span>
<span><span class="co">## [3] "list"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="two-fold-blocked-cross-validation">Two-Fold Blocked Cross-Validation<a class="anchor" aria-label="anchor" href="#two-fold-blocked-cross-validation"></a>
</h2>
<div class="section level3">
<h3 id="overview-3">Overview<a class="anchor" aria-label="anchor" href="#overview-3"></a>
</h3>
<p>This approach randomly splits blocks into two groups, useful for
rapid performance estimation.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create two-fold blocked CV with 10 repetitions</span></span>
<span><span class="va">twofold_cval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/twofold_blocked_cross_validation.html">twofold_blocked_cross_validation</a></span><span class="op">(</span><span class="va">block_var</span>, nreps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">twofold_cval</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Two-Fold Blocked Cross-Validation ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Configuration</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">100</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Number of Folds: </span> <span style="color: #00BB00;">2</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Repetitions: </span> <span style="color: #00BB00;">10</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Block Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Total Blocks: </span> <span style="color: #00BB00;">5</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #0000BB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #0000BB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Block Sizes: </span> <span style="color: #00BB00;">1: 20, 2: 20, 3: 20, 4: 20, 5: 20</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="custom-cross-validation">Custom Cross-Validation<a class="anchor" aria-label="anchor" href="#custom-cross-validation"></a>
</h2>
<div class="section level3">
<h3 id="overview-4">Overview<a class="anchor" aria-label="anchor" href="#overview-4"></a>
</h3>
<p>For specialized validation schemes, you can define custom
training/testing splits:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define custom splits</span></span>
<span><span class="va">custom_splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>train <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, test <span class="op">=</span> <span class="fl">61</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>train <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span>, test <span class="op">=</span> <span class="fl">41</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>train <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, test <span class="op">=</span> <span class="fl">81</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create custom CV</span></span>
<span><span class="va">custom_cval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">custom_cross_validation</a></span><span class="op">(</span><span class="va">custom_splits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">custom_cval</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $sample_set</span></span>
<span><span class="co">## $sample_set[[1]]</span></span>
<span><span class="co">## $sample_set[[1]]$train</span></span>
<span><span class="co">##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span></span>
<span><span class="co">## [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span></span>
<span><span class="co">## [51] 51 52 53 54 55 56 57 58 59 60</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sample_set[[1]]$test</span></span>
<span><span class="co">##  [1]  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79</span></span>
<span><span class="co">## [20]  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98</span></span>
<span><span class="co">## [39]  99 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sample_set[[2]]</span></span>
<span><span class="co">## $sample_set[[2]]$train</span></span>
<span><span class="co">##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span></span>
<span><span class="co">## [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sample_set[[2]]$test</span></span>
<span><span class="co">##  [1]  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59</span></span>
<span><span class="co">## [20]  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78</span></span>
<span><span class="co">## [39]  79  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97</span></span>
<span><span class="co">## [58]  98  99 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sample_set[[3]]</span></span>
<span><span class="co">## $sample_set[[3]]$train</span></span>
<span><span class="co">##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</span></span>
<span><span class="co">## [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50</span></span>
<span><span class="co">## [51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75</span></span>
<span><span class="co">## [76] 76 77 78 79 80</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sample_set[[3]]$test</span></span>
<span><span class="co">##  [1]  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99</span></span>
<span><span class="co">## [20] 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $nfolds</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "custom_cross_validation" "cross_validation"       </span></span>
<span><span class="co">## [3] "list"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="practical-example-model-training">Practical Example: Model Training<a class="anchor" aria-label="anchor" href="#practical-example-model-training"></a>
</h2>
<p>Here’s a complete example using blocked cross-validation with an SDA
classifier:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setup cross-validation</span></span>
<span><span class="va">block_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">cval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">blocked_cross_validation</a></span><span class="op">(</span><span class="va">block_var</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate CV samples</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crossval_samples.html">crossval_samples</a></span><span class="op">(</span><span class="va">cval</span>, <span class="va">dat</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train models for each fold</span></span>
<span><span class="va">model_fits</span> <span class="op">&lt;-</span> <span class="va">samples</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">do</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">train_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span>    <span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">.</span><span class="op">$</span><span class="va">ytrain</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sda/man/sda.html" class="external-link">sda</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_dat</span><span class="op">)</span>, <span class="va">y_train</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model_fits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 1</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">##   fit   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;sda&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;sda&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">&lt;sda&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> <span style="color: #949494;">&lt;sda&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> <span style="color: #949494;">&lt;sda&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<p>When choosing a cross-validation strategy, consider:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Data Structure</strong>
<ul>
<li>Use blocked CV when data has clear run/session boundaries</li>
<li>Consider sequential CV when temporal order matters</li>
<li>Use bootstrap blocked CV for more stable estimates</li>
</ul>
</li>
<li>
<strong>Sample Size</strong>
<ul>
<li>For small datasets, bootstrap blocked CV can help</li>
<li>For large datasets, simple blocked CV may suffice</li>
</ul>
</li>
<li>
<strong>Temporal Dependencies</strong>
<ul>
<li>Always respect the temporal structure of fMRI data</li>
<li>Avoid mixing training/testing data from the same run</li>
<li>Consider temporal autocorrelation</li>
</ul>
</li>
<li>
<strong>Computation Time</strong>
<ul>
<li>Bootstrap and sequential methods require more computation</li>
<li>Two-fold CV offers quick preliminary results</li>
<li>Balance estimation stability with computational cost</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Choose the right cross-validation strategy for your neuroimaging
data. Match the CV approach to your data structure, account for temporal
dependencies in fMRI, and use bootstrap methods when you need more
stable estimates. The rMVPA package supports all these approaches,
including custom schemes for specialized needs.</p>
<p>For implementation details, refer to the source code in
<code>crossval.R</code>.</p>
</div>
<div class="section level2">
<h2 id="integration-with-regional-and-searchlight-analyses">Integration with Regional and Searchlight Analyses<a class="anchor" aria-label="anchor" href="#integration-with-regional-and-searchlight-analyses"></a>
</h2>
<p>Cross-validation strategies in <code>rMVPA</code> are designed to
work seamlessly with both regional and searchlight analyses. Here we’ll
demonstrate how to incorporate different cross-validation schemes into
these analyses.</p>
<div class="section level3">
<h3 id="regional-analysis-example">Regional Analysis Example<a class="anchor" aria-label="anchor" href="#regional-analysis-example"></a>
</h3>
<p>Let’s perform a regional MVPA analysis using different
cross-validation strategies:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a sample dataset</span></span>
<span><span class="va">data_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_sample_dataset.html">gen_sample_dataset</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span>, nobs <span class="op">=</span> <span class="fl">80</span>, blocks <span class="op">=</span> <span class="fl">4</span>, nlevels <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a region mask</span></span>
<span><span class="va">mask</span> <span class="op">&lt;-</span> <span class="va">data_out</span><span class="op">$</span><span class="va">dataset</span><span class="op">$</span><span class="va">mask</span></span>
<span><span class="va">nvox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span></span>
<span><span class="va">region_mask</span> <span class="op">&lt;-</span> <span class="fu">neuroim2</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/neuroim2/reference/NeuroVol.html" class="external-link">NeuroVol</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, size <span class="op">=</span> <span class="va">nvox</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://bbuchsbaum.github.io/neuroim2/reference/space-methods.html" class="external-link">space</a></span><span class="op">(</span><span class="va">mask</span><span class="op">)</span>, </span>
<span>  indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">mask</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create MVPA dataset</span></span>
<span><span class="va">dset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_dataset.html">mvpa_dataset</a></span><span class="op">(</span><span class="va">data_out</span><span class="op">$</span><span class="va">dataset</span><span class="op">$</span><span class="va">train_data</span>, mask <span class="op">=</span> <span class="va">data_out</span><span class="op">$</span><span class="va">dataset</span><span class="op">$</span><span class="va">mask</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the classification model</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="st">"sda_notune"</span><span class="op">)</span></span>
<span><span class="va">tune_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.01</span>, diagonal <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example 1: Using Blocked Cross-Validation</span></span>
<span><span class="va">blocked_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">blocked_cross_validation</a></span><span class="op">(</span><span class="va">data_out</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span><span class="op">)</span></span>
<span><span class="va">mvpa_mod_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>, </span>
<span>  dataset <span class="op">=</span> <span class="va">dset</span>, </span>
<span>  design <span class="op">=</span> <span class="va">data_out</span><span class="op">$</span><span class="va">design</span>,</span>
<span>  crossval <span class="op">=</span> <span class="va">blocked_cv</span>,</span>
<span>  tune_grid <span class="op">=</span> <span class="va">tune_grid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run regional analysis with blocked CV</span></span>
<span><span class="va">results_blocked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_regional-methods.html">run_regional</a></span><span class="op">(</span><span class="va">mvpa_mod_blocked</span>, <span class="va">region_mask</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2025-09-27 16:45:08] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example 2: Using Bootstrap Blocked Cross-Validation</span></span>
<span><span class="va">bootstrap_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">bootstrap_blocked_cross_validation</a></span><span class="op">(</span></span>
<span>  <span class="va">data_out</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span>,</span>
<span>  nreps <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mvpa_mod_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  dataset <span class="op">=</span> <span class="va">dset</span>,</span>
<span>  design <span class="op">=</span> <span class="va">data_out</span><span class="op">$</span><span class="va">design</span>,</span>
<span>  crossval <span class="op">=</span> <span class="va">bootstrap_cv</span>,</span>
<span>  tune_grid <span class="op">=</span> <span class="va">tune_grid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run regional analysis with bootstrap CV</span></span>
<span><span class="va">results_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_regional-methods.html">run_regional</a></span><span class="op">(</span><span class="va">mvpa_mod_boot</span>, <span class="va">region_mask</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2025-09-27 16:45:12] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare performance between CV strategies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Blocked CV Performance:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Blocked CV Performance:</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results_blocked</span><span class="op">$</span><span class="va">performance_table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   roinum Accuracy    AUC</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>      1    0.6   0.097<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>      2    0.55  0.093<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>      3    0.575 0.114</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBootstrap CV Performance:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Bootstrap CV Performance:</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results_boot</span><span class="op">$</span><span class="va">performance_table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   roinum Accuracy    AUC</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>      1    0.575 0.056<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>      2    0.512 0.075<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>      3    0.588 0.090<span style="text-decoration: underline;">0</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="searchlight-analysis-example">Searchlight Analysis Example<a class="anchor" aria-label="anchor" href="#searchlight-analysis-example"></a>
</h3>
<p>We can also use different cross-validation strategies in searchlight
analysis:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example 3: Searchlight with Sequential Blocked Cross-Validation</span></span>
<span><span class="va">seq_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">sequential_blocked_cross_validation</a></span><span class="op">(</span></span>
<span>  <span class="va">data_out</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  nreps <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mvpa_mod_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  dataset <span class="op">=</span> <span class="va">dset</span>,</span>
<span>  design <span class="op">=</span> <span class="va">data_out</span><span class="op">$</span><span class="va">design</span>,</span>
<span>  crossval <span class="op">=</span> <span class="va">seq_cv</span>,</span>
<span>  tune_grid <span class="op">=</span> <span class="va">tune_grid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run searchlight analysis</span></span>
<span><span class="va">results_searchlight</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span></span>
<span>  <span class="va">mvpa_mod_seq</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"standard"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-considerations">Key Considerations<a class="anchor" aria-label="anchor" href="#key-considerations"></a>
</h3>
<p>When integrating cross-validation with regional or searchlight
analyses:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Memory Usage</strong>
<ul>
<li>Bootstrap and sequential methods generate more folds</li>
<li>Consider reducing <code>nreps</code> for large searchlight
analyses</li>
<li>Monitor memory usage with large datasets</li>
</ul>
</li>
<li>
<strong>Computation Time</strong>
<ul>
<li>Searchlight analysis multiplies computation across voxels</li>
<li>Two-fold CV might be preferable for initial searchlight
exploration</li>
<li>Use parallel processing when available</li>
</ul>
</li>
<li>
<strong>Result Stability</strong>
<ul>
<li>Bootstrap methods provide confidence intervals but require more
computation</li>
<li>Consider the trade-off between estimation stability and
computational cost</li>
<li>For searchlight analyses, simpler CV schemes might be
sufficient</li>
</ul>
</li>
<li>
<strong>Performance Metrics</strong>
<ul>
<li>Different CV schemes might produce slightly different performance
estimates</li>
<li>Bootstrap methods generally provide more conservative estimates</li>
<li>Consider averaging results across repetitions for bootstrap and
sequential CV</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="example-comparing-cv-strategies-in-regional-analysis">Example: Comparing CV Strategies in Regional Analysis<a class="anchor" aria-label="anchor" href="#example-comparing-cv-strategies-in-regional-analysis"></a>
</h3>
<p>Here’s a more detailed comparison of different CV strategies:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create different CV schemes</span></span>
<span><span class="va">cv_schemes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  blocked <span class="op">=</span> <span class="fu"><a href="../reference/cross_validation.html">blocked_cross_validation</a></span><span class="op">(</span><span class="va">data_out</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span><span class="op">)</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="fu"><a href="../reference/cross_validation.html">bootstrap_blocked_cross_validation</a></span><span class="op">(</span><span class="va">data_out</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span>, nreps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  twofold <span class="op">=</span> <span class="fu"><a href="../reference/twofold_blocked_cross_validation.html">twofold_blocked_cross_validation</a></span><span class="op">(</span><span class="va">data_out</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span>, nreps <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run regional analysis with each CV scheme</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cv_schemes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mvpa_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    dataset <span class="op">=</span> <span class="va">dset</span>,</span>
<span>    design <span class="op">=</span> <span class="va">data_out</span><span class="op">$</span><span class="va">design</span>,</span>
<span>    crossval <span class="op">=</span> <span class="va">cv</span>,</span>
<span>    tune_grid <span class="op">=</span> <span class="va">tune_grid</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/run_regional-methods.html">run_regional</a></span><span class="op">(</span><span class="va">mvpa_mod</span>, <span class="va">region_mask</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2025-09-27 16:45:13] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-09-27 16:45:17] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-09-27 16:45:18] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare performance across CV schemes</span></span>
<span><span class="va">performance_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">perf</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">performance_table</span></span>
<span>  <span class="va">perf</span><span class="op">$</span><span class="va">cv_scheme</span> <span class="op">&lt;-</span> <span class="va">name</span></span>
<span>  <span class="va">perf</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine results</span></span>
<span><span class="va">all_performance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">performance_comparison</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">all_performance</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">##   roinum Accuracy    AUC cv_scheme</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>      1    0.6   0.097<span style="text-decoration: underline;">5</span> blocked  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>      2    0.55  0.093<span style="text-decoration: underline;">1</span> blocked  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>      3    0.575 0.114  blocked  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>      1    0.6   0.067<span style="text-decoration: underline;">5</span> bootstrap</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>      2    0.55  0.066<span style="text-decoration: underline;">3</span> bootstrap</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>      3    0.6   0.070<span style="text-decoration: underline;">0</span> bootstrap</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>      1    0.588 0.102  twofold  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>      2    0.538 0.069<span style="text-decoration: underline;">4</span> twofold  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span>      3    0.6   0.081<span style="text-decoration: underline;">9</span> twofold</span></span></code></pre>
<p>This integration demonstrates how different cross-validation
strategies can be easily incorporated into the broader MVPA analysis
framework, allowing researchers to choose the most appropriate
validation approach for their specific analysis needs.</p>
<p>For more details on regional and searchlight analyses, refer to their
respective vignettes and the implementation in <code>regional.R</code>
and <code>searchlight.R</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
