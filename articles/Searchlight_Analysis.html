<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rMVPA">
<title>Searchlight Analysis • rMVPA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Searchlight Analysis">
<meta property="og:description" content="rMVPA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rMVPA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CommandLineScripts.html">Command-Line Scripts</a>
    <a class="dropdown-item" href="../articles/CrossValidation.html">Cross-Validation Schemes</a>
    <a class="dropdown-item" href="../articles/FeatureSelection.html">Feature Selection</a>
    <a class="dropdown-item" href="../articles/Regional_Analysis.html">Regional Analysis</a>
    <a class="dropdown-item" href="../articles/RSA.html">Represenational Similarity Analysis</a>
    <a class="dropdown-item" href="../articles/Searchlight_Analysis.html">Searchlight Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Searchlight Analysis</h1>
                        <h4 data-toc-skip class="author">Bradley
Buchsbaum</h4>
            
            <h4 data-toc-skip class="date">2024-04-22</h4>
      
      
      <div class="d-none name"><code>Searchlight_Analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="searchlight-analysis">Searchlight Analysis<a class="anchor" aria-label="anchor" href="#searchlight-analysis"></a>
</h2>
<div class="section level3">
<h3 id="generate-a-volumetric-dataset-with-100-observations-and-two-classes">Generate a volumetric dataset with 100 observations and two
classes<a class="anchor" aria-label="anchor" href="#generate-a-volumetric-dataset-with-100-observations-and-two-classes"></a>
</h3>
<p>To generate a dataset we use the <code>gen_sample_dataset</code>
function. We are creating a 4-dimensional neuroimaging dataset, with
6-by-6-by-6 spatial dimensions and 80 observations in the 4th dimension.
These 80 observations are divided into 4 blocks, each consisting of 20
trials. The generated <code>y</code> variable is a <code>factor</code>
with 2 levels (‘a’ and ‘b’). the <code>gen_sample_dataset</code>
function creates a list with two elements: an <code>mvpa_dataset</code>
object (<code>dataset</code>) and an <code>mvpa_design</code> object
(<code>design</code>). The first contains information about the data
itself and the second contains information about the experimental
design.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_sample_dataset.html">gen_sample_dataset</a></span><span class="op">(</span>D<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span>, nobs <span class="op">=</span> <span class="fl">80</span>, blocks<span class="op">=</span><span class="fl">4</span>, nlevels<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $dataset</span></span>
<span><span class="co">## $train_data</span></span>
<span><span class="co">## DenseNeuroVec </span></span>
<span><span class="co">##   Type           : DenseNeuroVec </span></span>
<span><span class="co">##   Dimension      : 6 6 6 80 </span></span>
<span><span class="co">##   Spacing        : 1  X  1  X  1 </span></span>
<span><span class="co">##   Origin         : 0  X  0  X  0 </span></span>
<span><span class="co">##   Axes           : Left-to-Right Posterior-to-Anterior Inferior-to-Superior </span></span>
<span><span class="co">##   Coordinate Transform : 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $test_data</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $mask</span></span>
<span><span class="co">## NeuroVol</span></span>
<span><span class="co">##   Type           : LogicalNeuroVol </span></span>
<span><span class="co">##   Dimension      : 6 6 6 </span></span>
<span><span class="co">##   Spacing        : 1  X  1  X  1 </span></span>
<span><span class="co">##   Origin         : 0  X  0  X  0 </span></span>
<span><span class="co">##   Axes           : Left-to-Right Posterior-to-Anterior Inferior-to-Superior </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "mvpa_image_dataset" "mvpa_dataset"       "list"              </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $design</span></span>
<span><span class="co">## mvpa_design: </span></span>
<span><span class="co">##   training observations:  80 </span></span>
<span><span class="co">##   training levels:  a b </span></span>
<span><span class="co">##   no test observations. </span></span>
<span><span class="co">##   training response:   Factor w/ 2 levels "a","b": 2 1 1 2 2 1 2 1 1 1 ... </span></span>
<span><span class="co">##   block var:   int [1:80] 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="create-a-cross-validation-object-using-a-pre-defined-blocking-variable-">Create a cross-validation object using a pre-defined blocking
variable.<a class="anchor" aria-label="anchor" href="#create-a-cross-validation-object-using-a-pre-defined-blocking-variable-"></a>
</h3>
<p>Most MVPA analyses involve the collection of fMRI data over a series
of scanning runs, or “blocks”. Due to intra-block serial correlations,
it makes sense to take advantage of this block structure for
cross-validation. In other words, we want to train the classifier on
<code>k-1</code> blocks and test on the set of trials for all
<code>k</code> held out blocks. This is a form of leave-one-group-out
cross-validation, which is encapsulated in the
<code>blocked_cross_validation</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span></span>
<span><span class="va">crossval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">blocked_cross_validation</a></span><span class="op">(</span><span class="va">block</span><span class="op">)</span></span>
<span><span class="va">crossval</span></span></code></pre></div>
<pre><code><span><span class="co">## cross-validation: blocked </span></span>
<span><span class="co">##   nobservations:  80 </span></span>
<span><span class="co">##   nfolds:  4 </span></span>
<span><span class="co">##   block sizes:  20 20 20 20</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="construct-an-mvpa_model-object-with-a-shrinkage-discriminant-analysis-classifier-sda_notune">Construct an <code>mvpa_model</code> object with a Shrinkage
Discriminant Analysis classifier (<code>sda_notune</code>)<a class="anchor" aria-label="anchor" href="#construct-an-mvpa_model-object-with-a-shrinkage-discriminant-analysis-classifier-sda_notune"></a>
</h3>
<p>The “sda_notune” model is an <code>sda</code> model where the
<code>lambda</code> parameter is estimated from the training data. See
documentation in the <a href="https://cran.r-project.org/web/packages/sda/index.html" class="external-link">sda
package</a> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sda_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="st">"sda_notune"</span><span class="op">)</span> </span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">sda_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span><span class="op">)</span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## mvpa_model object. </span></span>
<span><span class="co">## model:  sda_notune </span></span>
<span><span class="co">## model type:  classification </span></span>
<span><span class="co">## cross-validation: blocked </span></span>
<span><span class="co">##   nobservations:  80 </span></span>
<span><span class="co">##   nfolds:  4 </span></span>
<span><span class="co">##   block sizes:  20 20 20 20 </span></span>
<span><span class="co">## mvpa_dataset: </span></span>
<span><span class="co">##   train_data: DenseNeuroVec </span></span>
<span><span class="co">##   Type           : DenseNeuroVec </span></span>
<span><span class="co">##   Dimension      : 6 6 6 80 </span></span>
<span><span class="co">##   Spacing        : 1  X  1  X  1 </span></span>
<span><span class="co">##   Origin         : 0  X  0  X  0 </span></span>
<span><span class="co">##   Axes           : Left-to-Right Posterior-to-Anterior Inferior-to-Superior </span></span>
<span><span class="co">##   Coordinate Transform : 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 </span></span>
<span><span class="co">##   test_data: none. </span></span>
<span><span class="co">##   mask areas:  1/93 </span></span>
<span><span class="co">##   mask cardinality:  93 </span></span>
<span><span class="co">## mvpa_design: </span></span>
<span><span class="co">##   training observations:  80 </span></span>
<span><span class="co">##   training levels:  a b </span></span>
<span><span class="co">##   no test observations. </span></span>
<span><span class="co">##   training response:   Factor w/ 2 levels "a","b": 2 1 1 2 2 1 2 1 1 1 ... </span></span>
<span><span class="co">##   block var:   int [1:80] 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="run-a-standard-searchlight-analysis">Run a standard searchlight analysis<a class="anchor" aria-label="anchor" href="#run-a-standard-searchlight-analysis"></a>
</h3>
<p>The output of <code>run_searchlight</code> is a list of image volumes
containing performance measures for each spherical searchlight. For a
two-class classification problem, there are three output measures:
<code>Accuracy</code> and <code>AUC</code> (<code>AUC</code> has .5
subtracted from it, so that it is centered at 0 rather than .5).
<code>Accuracy</code> is the raw cross-validated accuracy measure for
each centroid and <code>AUC</code> is the area under the curve
statistic. The <code>radius</code> argument indicates the radius in
<code>mm</code> of the spherical searchlight. Finally,
<code>method</code> indicates the searchlight scheme, which can be
<code>standard</code> or <code>randomized</code>. See below for more
information about the randomized searchlight.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"standard"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2024-04-22 14:50:31] model is: sda_notune</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:31] running standard searchlight with 4 radius </span></span>
<span><span class="co">## INFO [2024-04-22 14:50:31] creating standard searchlight</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:31] running standard searchlight iterator</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:31] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:33] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:34] mvpa_iterate: compute analysis for batch 3 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:35] mvpa_iterate: compute analysis for batch 4 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:36] mvpa_iterate: compute analysis for batch 5 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:38] mvpa_iterate: compute analysis for batch 6 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:39] mvpa_iterate: compute analysis for batch 7 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:40] mvpa_iterate: compute analysis for batch 8 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:41] mvpa_iterate: compute analysis for batch 9 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:43] mvpa_iterate: compute analysis for batch 10 ...</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre></div>
<pre><code><span><span class="co">## $Accuracy</span></span>
<span><span class="co">## NeuroVol</span></span>
<span><span class="co">##   Type           : DenseNeuroVol </span></span>
<span><span class="co">##   Dimension      : 6 6 6 </span></span>
<span><span class="co">##   Spacing        : 1  X  1  X  1 </span></span>
<span><span class="co">##   Origin         : 0  X  0  X  0 </span></span>
<span><span class="co">##   Axes           : Left-to-Right Posterior-to-Anterior Inferior-to-Superior </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $AUC</span></span>
<span><span class="co">## NeuroVol</span></span>
<span><span class="co">##   Type           : DenseNeuroVol </span></span>
<span><span class="co">##   Dimension      : 6 6 6 </span></span>
<span><span class="co">##   Spacing        : 1  X  1  X  1 </span></span>
<span><span class="co">##   Origin         : 0  X  0  X  0 </span></span>
<span><span class="co">##   Axes           : Left-to-Right Posterior-to-Anterior Inferior-to-Superior</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">AUC</span><span class="op">)</span></span></code></pre></div>
<p><img src="Searchlight_Analysis_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="run-a-randomized-searchlight-analysis">Run a randomized searchlight analysis<a class="anchor" aria-label="anchor" href="#run-a-randomized-searchlight-analysis"></a>
</h2>
<p>A randomized searchlight analysis is an iterative procedure in which
searchlight regions are sampled <em>without replacement</em> from the
voxel set. A classification analysis is run for each region, and the
result is recorded for the center voxel and <em>all other voxels in the
region</em>. This is done for each of <code>niter</code> times, where
each iteration involves an exhaustive sampling of the voxel set. The
performance at each voxel is the average performance for the set of
analyses in which the given voxel was included as a feature. The result
will be similar to the standard searchlight procedure, but emphasizes
the contribution of a given voxel across different local contexts to
classification performance. This should in principle offer slightly
better spatial localization than the standard searchlight. The
randomized searchlight procedure can also be faster, because the total
number of estimated models is a function of
<code>nvoxels/radius * niter</code>, which will be smaller than
<code>nvoxels</code> for many choices of <code>radius</code> and
<code>niter</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2024-04-22 14:50:44] model is: sda_notune</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:44] running randomized searchlight with 4 radius and 8 iterations</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:44] searchlight iteration: 1</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:44] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:44] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:45] mvpa_iterate: compute analysis for batch 3 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:45] searchlight iteration: 2</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:45] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:45] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:45] searchlight iteration: 3</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:45] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:46] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:46] searchlight iteration: 4</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:46] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:46] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:47] searchlight iteration: 5</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:47] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:47] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:47] mvpa_iterate: compute analysis for batch 3 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:47] searchlight iteration: 6</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:47] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:48] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:48] searchlight iteration: 7</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:48] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:48] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:48] mvpa_iterate: compute analysis for batch 3 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:48] searchlight iteration: 8</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:48] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:49] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:49] mvpa_iterate: compute analysis for batch 3 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:49] mvpa_iterate: compute analysis for batch 4 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:49] number of models fit: 17</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre></div>
<pre><code><span><span class="co">## $Accuracy</span></span>
<span><span class="co">## NeuroVol</span></span>
<span><span class="co">##   Type           : DenseNeuroVol </span></span>
<span><span class="co">##   Dimension      : 6 6 6 </span></span>
<span><span class="co">##   Spacing        : 1  X  1  X  1 </span></span>
<span><span class="co">##   Origin         : 0  X  0  X  0 </span></span>
<span><span class="co">##   Axes           : Left-to-Right Posterior-to-Anterior Inferior-to-Superior </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $AUC</span></span>
<span><span class="co">## NeuroVol</span></span>
<span><span class="co">##   Type           : DenseNeuroVol </span></span>
<span><span class="co">##   Dimension      : 6 6 6 </span></span>
<span><span class="co">##   Spacing        : 1  X  1  X  1 </span></span>
<span><span class="co">##   Origin         : 0  X  0  X  0 </span></span>
<span><span class="co">##   Axes           : Left-to-Right Posterior-to-Anterior Inferior-to-Superior</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">AUC</span><span class="op">)</span></span></code></pre></div>
<p><img src="Searchlight_Analysis_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="using-different-classifiers">Using different classifiers<a class="anchor" aria-label="anchor" href="#using-different-classifiers"></a>
</h2>
<p>All of the classifiers available in the <code>caret</code> package
can be used (in theory) for a searchlight analysis. For example, we can
run an analysis using a linear support vector (<code>svmLinear</code>)
machine as follows:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="st">"svmLinear"</span><span class="op">)</span> </span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">svm_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span><span class="op">)</span></span>
<span><span class="va">result_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Here we use a random forest classifier. To fix the tuning parameter
<code>mtry</code> at a known value, we supply a <code>tune_grid</code>
argument to the <code>mvpa_model</code> function. Here, we set
<code>mtry</code> to <code>2</code>. Sinc ethere is only one value, it
means that this parameter will be fixed. If we supply a grid of values,
then the paramter will be tuned for each searchlight sample. Since
parameter tuning is costly in terms of computing time, this is not a
recommended approach unless one has a great deal of computing power or
one is running the searchlight over a small mask.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="st">"rf"</span><span class="op">)</span> </span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">rf_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span>, tune_grid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mtry<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2024-04-22 14:50:50] model is: rf</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:50] running randomized searchlight with 4 radius and 2 iterations</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:50] searchlight iteration: 1</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:50] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:51] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:51] mvpa_iterate: compute analysis for batch 3 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:51] mvpa_iterate: compute analysis for batch 4 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:51] searchlight iteration: 2</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:51] mvpa_iterate: compute analysis for batch 1 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:52] mvpa_iterate: compute analysis for batch 2 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:52] mvpa_iterate: compute analysis for batch 3 ...</span></span>
<span><span class="co">## INFO [2024-04-22 14:50:52] number of models fit: 5</span></span></code></pre>
<p>Here we specify a range of values for the <code>mtry</code> tuning
parameter. In this case, by supplying the <code>tune_reps</code>
argument to <code>mvpa_model</code> we control the number of resamples
used to tune the model parameters. The default is 10, but here we speed
up execution time by reducing it to 2. In general, more resamples are
required to reliably estimate optimal tuning parameters. This means for
a whole-brain searchlight, parameter tuning is
<strong>generally</strong> impractical. This is why the classifier
<code>sda_notune</code> is a good choice for searchlight analyses, since
it “works well” with default tuning parameters.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mtry<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">rf_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span>, tune_grid<span class="op">=</span><span class="va">grid</span>, tune_reps<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_rf_tuned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model2</span>, radius<span class="op">=</span><span class="fl">6</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<!-- ## External Cross-Validation Example -->
<!-- Instead of using internal cross-validation, as we used in the above examples, sometimes one might have a held-out test data that can be used as a validation set. Here we show how to  -->
<!-- ```{r} -->
<!-- # Create training data -->
<!-- train_design <- data.frame(y = rep(letters[1:4], 5), x1 = rnorm(20), x2 = rnorm(20), block = rep(1:4, each = 5)) -->
<!-- # Create test data -->
<!-- test_design <- data.frame(y = sample(letters[1:4], 10, replace=TRUE)) -->
<!-- # Create an MVPA design object with external cross-validation -->
<!-- design <- mvpa_design(train_design, ~ y, block_var = ~ block, test_design = test_design, y_test = ~ y) -->
<!-- # Display the MVPA design object -->
<!-- print(design) -->
<!-- # Create a new dataset for external cross-validation -->
<!-- dataset_ext <- list(dataset = dataset$dataset, design = design) -->
<!-- # Construct an `mvpa_model` object with a Shrinkage Discriminant Analysis classifier (`sda_notune`) -->
<!-- sda_model_ext <- load_model("sda_notune") -->
<!-- model_ext <- mvpa_model(model = sda_model_ext, dataset = dataset_ext$dataset, design = dataset_ext$design) -->
<!-- # Run a randomized searchlight analysis using external cross-validation -->
<!-- result_ext <- run_searchlight(model_ext, radius = 4, method = "randomized", niter = 8) -->
<!-- # Display the results -->
<!-- print(result_ext) -->
<!-- # Plot a histogram of AUC values -->
<!-- hist(result_ext$AUC) -->
<!-- ``` -->
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
