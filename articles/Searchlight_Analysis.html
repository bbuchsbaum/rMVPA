<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Searchlight Analysis • rMVPA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Searchlight Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rMVPA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Searchlight Analysis</h1>
                        <h4 data-toc-skip class="author">Bradley
Buchsbaum</h4>
            
            <h4 data-toc-skip class="date">2025-02-13</h4>
      

      <div class="d-none name"><code>Searchlight_Analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="searchlight-analysis">Searchlight Analysis<a class="anchor" aria-label="anchor" href="#searchlight-analysis"></a>
</h2>
<div class="section level3">
<h3 id="generate-a-volumetric-dataset-with-100-observations-and-two-classes">Generate a volumetric dataset with 100 observations and two
classes<a class="anchor" aria-label="anchor" href="#generate-a-volumetric-dataset-with-100-observations-and-two-classes"></a>
</h3>
<p>To generate a dataset we use the <code>gen_sample_dataset</code>
function. We are creating a 4-dimensional neuroimaging dataset, with
6-by-6-by-6 spatial dimensions and 80 observations in the 4th dimension.
These 80 observations are divided into 4 blocks, each consisting of 20
trials. The generated <code>y</code> variable is a <code>factor</code>
with 2 levels (‘a’ and ‘b’). the <code>gen_sample_dataset</code>
function creates a list with two elements: an <code>mvpa_dataset</code>
object (<code>dataset</code>) and an <code>mvpa_design</code> object
(<code>design</code>). The first contains information about the data
itself and the second contains information about the experimental
design.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_sample_dataset.html">gen_sample_dataset</a></span><span class="op">(</span>D<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span>, nobs <span class="op">=</span> <span class="fl">80</span>, blocks<span class="op">=</span><span class="fl">4</span>, nlevels<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $dataset</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ MVPA Dataset ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Training Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Dimensions: </span> <span style="color: #00BB00;">6 × 6 × 6 × </span><span style="color: #0000BB; font-style: italic;">80</span><span style="color: #00BB00;"> observations</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Type: </span> DenseNeuroVec </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Test Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ </span> <span style="color: #BB0000;">None</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Mask Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Areas: </span> 1 : <span style="color: #00BB00;">120</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Active voxels/vertices: </span> <span style="color: #00BB00;">120</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $design</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ MVPA Design ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Training Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">80</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Response Type: </span> Factor</span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Levels: </span> <span style="color: #0000BB;">a, b</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Class Distribution: </span> <span style="color: #00BB00;">a: 40, b: 40</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Test Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ </span> <span style="color: #BB0000;">None</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Structure</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Blocking: </span> Present</span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Number of Blocks: </span> <span style="color: #00BB00;">4</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #BBBBBB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #BBBBBB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Split Groups: </span> <span style="color: #BB0000;">None</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="create-a-cross-validation-object-using-a-pre-defined-blocking-variable-">Create a cross-validation object using a pre-defined blocking
variable.<a class="anchor" aria-label="anchor" href="#create-a-cross-validation-object-using-a-pre-defined-blocking-variable-"></a>
</h3>
<p>Most MVPA analyses involve the collection of fMRI data over a series
of scanning runs, or “blocks”. Due to intra-block serial correlations,
it makes sense to take advantage of this block structure for
cross-validation. In other words, we want to train the classifier on
<code>k-1</code> blocks and test on the set of trials for all
<code>k</code> held out blocks. This is a form of leave-one-group-out
cross-validation, which is encapsulated in the
<code>blocked_cross_validation</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">block_var</span></span>
<span><span class="va">crossval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validation.html">blocked_cross_validation</a></span><span class="op">(</span><span class="va">block</span><span class="op">)</span></span>
<span><span class="va">crossval</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Blocked Cross-Validation ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Dataset Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">80</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Number of Folds: </span> <span style="color: #00BB00;">4</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Block Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Total Blocks: </span> <span style="color: #00BB00;">4</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #0000BB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #0000BB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Block Sizes: </span> <span style="color: #00BB00;">1: 20, 2: 20, 3: 20, 4: 20</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="construct-an-mvpa_model-object-with-a-shrinkage-discriminant-analysis-classifier-sda_notune">Construct an <code>mvpa_model</code> object with a Shrinkage
Discriminant Analysis classifier (<code>sda_notune</code>)<a class="anchor" aria-label="anchor" href="#construct-an-mvpa_model-object-with-a-shrinkage-discriminant-analysis-classifier-sda_notune"></a>
</h3>
<p>The “sda_notune” model is an <code>sda</code> model where the
<code>lambda</code> parameter is estimated from the training data. See
documentation in the <a href="https://cran.r-project.org/web/packages/sda/index.html" class="external-link">sda
package</a> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sda_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="st">"sda_notune"</span><span class="op">)</span> </span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">sda_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span><span class="op">)</span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## mvpa_model object. </span></span>
<span><span class="co">## model:  sda_notune </span></span>
<span><span class="co">## model type:  classification </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Blocked Cross-Validation ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Dataset Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">80</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Number of Folds: </span> <span style="color: #00BB00;">4</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Block Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Total Blocks: </span> <span style="color: #00BB00;">4</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #0000BB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #0000BB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Block Sizes: </span> <span style="color: #00BB00;">1: 20, 2: 20, 3: 20, 4: 20</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ MVPA Dataset ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Training Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Dimensions: </span> <span style="color: #00BB00;">6 × 6 × 6 × </span><span style="color: #0000BB; font-style: italic;">80</span><span style="color: #00BB00;"> observations</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Type: </span> DenseNeuroVec </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Test Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ </span> <span style="color: #BB0000;">None</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Mask Information</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Areas: </span> 1 : <span style="color: #00BB00;">120</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Active voxels/vertices: </span> <span style="color: #00BB00;">120</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ MVPA Design ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Training Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Observations: </span> <span style="color: #00BB00;">80</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Response Type: </span> Factor</span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Levels: </span> <span style="color: #0000BB;">a, b</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Class Distribution: </span> <span style="color: #00BB00;">a: 40, b: 40</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Test Data</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ </span> <span style="color: #BB0000;">None</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Structure</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Blocking: </span> Present</span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Number of Blocks: </span> <span style="color: #00BB00;">4</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ Mean Block Size: </span> <span style="color: #00BB00;">20</span> <span style="color: #BBBBBB; font-style: italic;"> (SD: </span> <span style="color: #00BB00;">0</span> <span style="color: #BBBBBB; font-style: italic;">)</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   └─ Split Groups: </span> <span style="color: #BB0000;">None</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="run-a-standard-searchlight-analysis">Run a standard searchlight analysis<a class="anchor" aria-label="anchor" href="#run-a-standard-searchlight-analysis"></a>
</h3>
<p>The output of <code>run_searchlight</code> is a list of image volumes
containing performance measures for each spherical searchlight. For a
two-class classification problem, there are three output measures:
<code>Accuracy</code> and <code>AUC</code> (<code>AUC</code> has .5
subtracted from it, so that it is centered at 0 rather than .5).
<code>Accuracy</code> is the raw cross-validated accuracy measure for
each centroid and <code>AUC</code> is the area under the curve
statistic. The <code>radius</code> argument indicates the radius in
<code>mm</code> of the spherical searchlight. Finally,
<code>method</code> indicates the searchlight scheme, which can be
<code>standard</code> or <code>randomized</code>. See below for more
information about the randomized searchlight.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"standard"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2025-02-13 23:41:34] Running standard searchlight with radius = 4</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:34] creating standard searchlight</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:34] running standard searchlight iterator</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:34] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:35] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:36] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:37] ⚡ Processing batch <span style="color: #0000BB;">4</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:38] ⚡ Processing batch <span style="color: #0000BB;">5</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:40] ⚡ Processing batch <span style="color: #0000BB;">6</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:41] ⚡ Processing batch <span style="color: #0000BB;">7</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:42] ⚡ Processing batch <span style="color: #0000BB;">8</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:43] ⚡ Processing batch <span style="color: #0000BB;">9</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:44] ⚡ Processing batch <span style="color: #0000BB;">10</span>/<span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">120</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">120</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Searchlight Analysis Results ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Coverage</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Total Voxels: </span> <span style="color: #00BB00;">216</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Active Voxels: </span> <span style="color: #00BB00;">120</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Performance Metrics</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ </span> <span style="color: #BB00BB;">Accuracy</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Mean: </span> <span style="color: #00BB00;">0.4898</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ SD: </span> <span style="color: #00BB00;">0.0083</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Min: </span> <span style="color: #00BB00;">0.4679</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  └─ Max: </span> <span style="color: #00BB00;">0.5118</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ </span> <span style="color: #BB00BB;">AUC</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Mean: </span> <span style="color: #00BB00;">-0.0168</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ SD: </span> <span style="color: #00BB00;">0.0109</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Min: </span> <span style="color: #00BB00;">-0.0437</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  └─ Max: </span> <span style="color: #00BB00;">0.0140</span></span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">AUC</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="Searchlight_Analysis_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="run-a-randomized-searchlight-analysis">Run a randomized searchlight analysis<a class="anchor" aria-label="anchor" href="#run-a-randomized-searchlight-analysis"></a>
</h2>
<p>A randomized searchlight analysis is an iterative procedure in which
searchlight regions are sampled <em>without replacement</em> from the
voxel set. A classification analysis is run for each region, and the
result is recorded for the center voxel and <em>all other voxels in the
region</em>. This is done for each of <code>niter</code> times, where
each iteration involves an exhaustive sampling of the voxel set. The
performance at each voxel is the average performance for the set of
analyses in which the given voxel was included as a feature. The result
will be similar to the standard searchlight procedure, but emphasizes
the contribution of a given voxel across different local contexts to
classification performance. This should in principle offer slightly
better spatial localization than the standard searchlight. The
randomized searchlight procedure can also be faster, because the total
number of estimated models is a function of
<code>nvoxels/radius * niter</code>, which will be smaller than
<code>nvoxels</code> for many choices of <code>radius</code> and
<code>niter</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2025-02-13 23:41:45] Running randomized searchlight with radius = 4 and niter = 8</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] searchlight iteration: 1</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] searchlight iteration: 2</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:45] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] searchlight iteration: 3</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] searchlight iteration: 4</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:46] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] ⚡ Processing batch <span style="color: #0000BB;">4</span>/<span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] searchlight iteration: 5</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] searchlight iteration: 6</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:47] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] searchlight iteration: 7</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] searchlight iteration: 8</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:48] ⚡ Processing batch <span style="color: #0000BB;">3</span>/<span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:49] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:49] number of models fit: 24</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  <span style="color: #00BBBB; font-weight: bold;">█▀▀ Searchlight Analysis Results ▀▀█</span> </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #BBBB00;">├─ Coverage</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  ├─ Total Voxels: </span> <span style="color: #00BB00;">216</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">│  └─ Active Voxels: </span> <span style="color: #00BB00;">120</span> </span></span>
<span><span class="co">## <span style="color: #BBBB00;">└─ Performance Metrics</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ </span> <span style="color: #BB00BB;">Accuracy</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Mean: </span> <span style="color: #00BB00;">0.4775</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ SD: </span> <span style="color: #00BB00;">0.0319</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Min: </span> <span style="color: #00BB00;">0.4094</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  └─ Max: </span> <span style="color: #00BB00;">0.5234</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   ├─ </span> <span style="color: #BB00BB;">AUC</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Mean: </span> <span style="color: #00BB00;">-0.0331</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ SD: </span> <span style="color: #00BB00;">0.0429</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  ├─ Min: </span> <span style="color: #00BB00;">-0.1187</span> </span></span>
<span><span class="co">## <span style="color: #BBBBBB;">   │  └─ Max: </span> <span style="color: #00BB00;">0.0331</span></span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">AUC</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="Searchlight_Analysis_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="using-different-classifiers">Using different classifiers<a class="anchor" aria-label="anchor" href="#using-different-classifiers"></a>
</h2>
<p>All of the classifiers available in the <code>caret</code> package
can be used (in theory) for a searchlight analysis. For example, we can
run an analysis using a linear support vector (<code>svmLinear</code>)
machine as follows:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="st">"svmLinear"</span><span class="op">)</span> </span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">svm_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span><span class="op">)</span></span>
<span><span class="va">result_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Here we use a random forest classifier. To fix the tuning parameter
<code>mtry</code> at a known value, we supply a <code>tune_grid</code>
argument to the <code>mvpa_model</code> function. Here, we set
<code>mtry</code> to <code>2</code>. Sinc ethere is only one value, it
means that this parameter will be fixed. If we supply a grid of values,
then the paramter will be tuned for each searchlight sample. Since
parameter tuning is costly in terms of computing time, this is not a
recommended approach unless one has a great deal of computing power or
one is running the searchlight over a small mask.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="st">"rf"</span><span class="op">)</span> </span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">rf_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span>, tune_grid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mtry<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model</span>, radius<span class="op">=</span><span class="fl">4</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## INFO [2025-02-13 23:41:49] Running randomized searchlight with radius = 4 and niter = 2</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:49] searchlight iteration: 1</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:49] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:49] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:50] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:50] searchlight iteration: 2</span></span>
<span><span class="co">## INFO [2025-02-13 23:41:50] ⚡ Processing batch <span style="color: #0000BB;">1</span>/<span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:50] ⚡ Processing batch <span style="color: #0000BB;">2</span>/<span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:50] </span></span>
<span><span class="co">## ✨ MVPA Iteration Complete</span></span>
<span><span class="co">## ├─ Total ROIs: <span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## ├─ Processed: <span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## └─ Skipped: <span style="color: #BBBB00;">0</span></span></span>
<span><span class="co">## INFO [2025-02-13 23:41:50] number of models fit: 4</span></span></code></pre>
<p>Here we specify a range of values for the <code>mtry</code> tuning
parameter. In this case, by supplying the <code>tune_reps</code>
argument to <code>mvpa_model</code> we control the number of resamples
used to tune the model parameters. The default is 10, but here we speed
up execution time by reducing it to 2. In general, more resamples are
required to reliably estimate optimal tuning parameters. This means for
a whole-brain searchlight, parameter tuning is
<strong>generally</strong> impractical. This is why the classifier
<code>sda_notune</code> is a good choice for searchlight analyses, since
it “works well” with default tuning parameters.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mtry<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvpa_model.html">mvpa_model</a></span><span class="op">(</span>model<span class="op">=</span><span class="va">rf_model</span>, dataset<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">dataset</span>, design<span class="op">=</span><span class="va">dataset</span><span class="op">$</span><span class="va">design</span>, crossval<span class="op">=</span><span class="va">crossval</span>, tune_grid<span class="op">=</span><span class="va">grid</span>, tune_reps<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_rf_tuned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_searchlight.html">run_searchlight</a></span><span class="op">(</span><span class="va">model2</span>, radius<span class="op">=</span><span class="fl">6</span>, method<span class="op">=</span><span class="st">"randomized"</span>, niter<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<!-- ## External Cross-Validation Example -->
<!-- Instead of using internal cross-validation, as we used in the above examples, sometimes one might have a held-out test data that can be used as a validation set. Here we show how to  -->
<!-- ```{r} -->
<!-- # Create training data -->
<!-- train_design <- data.frame(y = rep(letters[1:4], 5), x1 = rnorm(20), x2 = rnorm(20), block = rep(1:4, each = 5)) -->
<!-- # Create test data -->
<!-- test_design <- data.frame(y = sample(letters[1:4], 10, replace=TRUE)) -->
<!-- # Create an MVPA design object with external cross-validation -->
<!-- design <- mvpa_design(train_design, ~ y, block_var = ~ block, test_design = test_design, y_test = ~ y) -->
<!-- # Display the MVPA design object -->
<!-- print(design) -->
<!-- # Create a new dataset for external cross-validation -->
<!-- dataset_ext <- list(dataset = dataset$dataset, design = design) -->
<!-- # Construct an `mvpa_model` object with a Shrinkage Discriminant Analysis classifier (`sda_notune`) -->
<!-- sda_model_ext <- load_model("sda_notune") -->
<!-- model_ext <- mvpa_model(model = sda_model_ext, dataset = dataset_ext$dataset, design = dataset_ext$design) -->
<!-- # Run a randomized searchlight analysis using external cross-validation -->
<!-- result_ext <- run_searchlight(model_ext, radius = 4, method = "randomized", niter = 8) -->
<!-- # Display the results -->
<!-- print(result_ext) -->
<!-- # Plot a histogram of AUC values -->
<!-- hist(result_ext$AUC) -->
<!-- ``` -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
