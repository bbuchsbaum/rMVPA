<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MVPA Regional Analysis Tutorial • rMVPA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MVPA Regional Analysis Tutorial">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rMVPA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MVPA Regional Analysis Tutorial</h1>
                        <h4 data-toc-skip class="author">Your Name</h4>
            
            <h4 data-toc-skip class="date">2025-09-28</h4>
      

      <div class="d-none name"><code>MVPA_RegionalCmdline.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial explains how to run <strong>regional multivariate
pattern analysis (MVPA)</strong> using <strong>MVPA_Regional.R</strong>.
The script performs MVPA on specified brain regions, enabling both
classification and regression analyses on fMRI data. Regional analysis
can be conducted on volumetric (NIfTI) or surface-based neuroimaging
data, and allows for separate training and testing subsets.</p>
<div class="section level3">
<h3 id="key-features">Key features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<p>The script supports volumetric NIfTI and surface data, separate
training/testing subsets, and full configuration via YAML or R files.
Outputs include region‑level performance maps, prediction tables, and a
configuration record. Cross‑validation options include blocked, k‑fold,
and two‑fold. Built‑in MVPA models are available from the registry, and
preprocessing includes optional centering/scaling and feature
selection.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="running-the-script">Running the Script<a class="anchor" aria-label="anchor" href="#running-the-script"></a>
</h2>
<div class="section level3">
<h3 id="basic-usage">1. Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h3>
<p>If you have:</p>
<ul>
<li>A <strong>4D fMRI file</strong> for training (e.g.,
<code>train_data.nii</code>)</li>
<li>A <strong>trial-by-trial design matrix</strong> (e.g.,
<code>train_design.txt</code>)</li>
<li>A <strong>brain mask file</strong> (e.g.,
<code>mask.nii</code>)</li>
</ul>
<p>You can run the regional analysis from the command line:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">Rscript</span> MVPA_Regional.R <span class="at">--train_design</span><span class="op">=</span>train_design.txt <span class="dt">\</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                         <span class="at">--train_data</span><span class="op">=</span>train_data.nii <span class="dt">\</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                         <span class="at">--mask</span><span class="op">=</span>mask.nii <span class="dt">\</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                         <span class="at">--model</span><span class="op">=</span>sda_notune <span class="dt">\</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                         <span class="at">--label_column</span><span class="op">=</span>condition <span class="dt">\</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                         <span class="at">--ncores</span><span class="op">=</span>4 <span class="dt">\</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                         <span class="at">--output</span><span class="op">=</span>my_regional_output</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-modes">2. Data modes<a class="anchor" aria-label="anchor" href="#data-modes"></a>
</h3>
<p>The script supports two primary data modes:</p>
<div class="section level4">
<h4 id="image-mode-volumetric">Image mode (volumetric)<a class="anchor" aria-label="anchor" href="#image-mode-volumetric"></a>
</h4>
<p>Default (<code>--data_mode=image</code>): NIfTI files with a binary
mask; analyzes region‑level data based on voxel masks.</p>
</div>
<div class="section level4">
<h4 id="surface-mode">Surface mode<a class="anchor" aria-label="anchor" href="#surface-mode"></a>
</h4>
<p>Use <code>--data_mode=surface</code> for cortical meshes; multiple
surface sections are supported.</p>
</div>
</div>
<div class="section level3">
<h3 id="models">3. Models<a class="anchor" aria-label="anchor" href="#models"></a>
</h3>
<p>The script supports various classification and regression models:</p>
<div class="section level4">
<h4 id="builtin-mvpa-models">Built‑in MVPA models<a class="anchor" aria-label="anchor" href="#builtin-mvpa-models"></a>
</h4>
<ul>
<li>
<code>corclass</code>: Correlation-based classifier with template
matching</li>
<li>
<code>sda_notune</code>: Shrinkage Discriminant Analysis without
tuning</li>
<li>
<code>sda_boot</code>: SDA with bootstrap resampling</li>
<li>
<code>glmnet_opt</code>: Elastic net with EPSGO parameter
optimization</li>
<li>
<code>sparse_sda</code>: SDA with sparsity constraints</li>
<li>
<code>sda_ranking</code>: SDA with automatic feature ranking</li>
<li>
<code>mgsda</code>: Multi-Group Sparse Discriminant Analysis</li>
<li>
<code>lda_thomaz</code>: Modified LDA for high-dimensional data</li>
<li>
<code>hdrda</code>: High-Dimensional Regularized Discriminant
Analysis</li>
</ul>
<p>You can also register custom models via
<code><a href="../reference/register_mvpa_model.html">register_mvpa_model()</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="crossvalidation-options">4. Cross‑validation options<a class="anchor" aria-label="anchor" href="#crossvalidation-options"></a>
</h3>
<p>Multiple cross-validation strategies are available:</p>
<div class="section level4">
<h4 id="blocked-cross-validation">Blocked Cross-Validation<a class="anchor" aria-label="anchor" href="#blocked-cross-validation"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">--block_column=session</span></span></code></pre></div>
<p>Uses a blocking variable (e.g., session) for splitting the data.</p>
</div>
<div class="section level4">
<h4 id="k-fold-cross-validation">K-Fold Cross-Validation<a class="anchor" aria-label="anchor" href="#k-fold-cross-validation"></a>
</h4>
<p>Default when no block column is specified; uses random splits.</p>
</div>
<div class="section level4">
<h4 id="two-fold-cross-validation">Two-Fold Cross-Validation<a class="anchor" aria-label="anchor" href="#two-fold-cross-validation"></a>
</h4>
<p>Specify in the configuration file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">cross_validation</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"twofold"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="at">  </span><span class="fu">nreps</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="advanced-crossvalidation-methods">Advanced cross‑validation methods<a class="anchor" aria-label="anchor" href="#advanced-crossvalidation-methods"></a>
</h4>
<p>Beyond blocked and k‑fold splits, you can use bootstrap blocked CV
(resampling within runs), sequential blocked CV (ordered folds), or
provide custom train/test indices. Specify the method in the config file
under <code>cross_validation.name</code>. For example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">cross_validation</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"bootstrap"</span><span class="co">   # Options: "twofold", "bootstrap", "sequential", "custom", "kfold"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="at">  </span><span class="fu">nreps</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span></code></pre></div>
<p>Choose the method that best matches your data structure and
experimental design.</p>
</div>
</div>
<div class="section level3">
<h3 id="feature-selection">5. Feature Selection<a class="anchor" aria-label="anchor" href="#feature-selection"></a>
</h3>
<p>Enable feature selection with:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">feature_selector</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="at">  </span><span class="fu">method</span><span class="kw">:</span><span class="at"> </span><span class="st">"anova"</span><span class="co">  # Options: "correlation", "t-test", etc.</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="at">  </span><span class="fu">cutoff_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"percentile"</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="at">  </span><span class="fu">cutoff_value</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="understanding-label_column">6. Understanding <code>label_column</code><a class="anchor" aria-label="anchor" href="#understanding-label_column"></a>
</h3>
<p>The <strong>label column</strong> specifies the target variable:</p>
<ul>
<li>For <strong>classification</strong>, it should contain categorical
labels (e.g., “Face”, “House”).</li>
<li>For <strong>regression</strong>, it should contain continuous values
(e.g., reaction times).</li>
</ul>
<p><strong>Example Design File
(<code>train_design.txt</code>):</strong></p>
<pre><code>trial  condition  subject  session
1      Face       S01      1
2      House      S01      1
3      Face       S01      1
4      House      S01      1
5      Face       S01      2</code></pre>
</div>
<div class="section level3">
<h3 id="using-a-configuration-file">7. Using a Configuration File<a class="anchor" aria-label="anchor" href="#using-a-configuration-file"></a>
</h3>
<p>Instead of specifying all options on the command line, you can use a
configuration file.</p>
<p><strong>Example YAML Config File
(<code>regional_config.yaml</code>):</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Data Sources</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">train_design</span><span class="kw">:</span><span class="at"> </span><span class="st">"train_design.txt"</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">test_design</span><span class="kw">:</span><span class="at"> </span><span class="st">"test_design.txt"</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">train_data</span><span class="kw">:</span><span class="at"> </span><span class="st">"train_data.nii"</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="fu">test_data</span><span class="kw">:</span><span class="at"> </span><span class="st">"test_data.nii"</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="fu">mask</span><span class="kw">:</span><span class="at"> </span><span class="st">"mask.nii"</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co"># Analysis Parameters</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">model</span><span class="kw">:</span><span class="at"> </span><span class="st">"rf"</span><span class="co">  # Random Forest classifier</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">data_mode</span><span class="kw">:</span><span class="at"> </span><span class="st">"image"</span><span class="co">  # or "surface"</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="fu">ncores</span><span class="kw">:</span><span class="at"> </span><span class="dv">4</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="fu">label_column</span><span class="kw">:</span><span class="at"> </span><span class="st">"condition"</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="fu">block_column</span><span class="kw">:</span><span class="at"> </span><span class="st">"session"</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co"># Output Options</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span><span class="at"> </span><span class="st">"regional_results"</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="fu">normalize_samples</span><span class="kw">:</span><span class="at"> </span><span class="ch">TRUE</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="fu">class_metrics</span><span class="kw">:</span><span class="at"> </span><span class="ch">TRUE</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co"># Advanced Options</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="fu">feature_selector</span><span class="kw">:</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="at">  </span><span class="fu">method</span><span class="kw">:</span><span class="at"> </span><span class="st">"anova"</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="at">  </span><span class="fu">cutoff_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"percentile"</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="at">  </span><span class="fu">cutoff_value</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="fu">cross_validation</span><span class="kw">:</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"twofold"</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="at">  </span><span class="fu">nreps</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co"># Optional Subsetting: Define different subsets for training and testing</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="fu">train_subset</span><span class="kw">:</span><span class="at"> </span><span class="st">"subject == 'S01'"</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="fu">test_subset</span><span class="kw">:</span><span class="at"> </span><span class="st">"subject == 'S02'"</span></span></code></pre></div>
<p><strong>Running with a Config File:</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">Rscript</span> MVPA_Regional.R <span class="at">--config</span><span class="op">=</span>regional_config.yaml</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expected-outputs">8. Expected Outputs<a class="anchor" aria-label="anchor" href="#expected-outputs"></a>
</h3>
<p>After running the script, the output directory (e.g.,
<code>regional_results/</code>) contains:</p>
<ul>
<li>
<strong>Performance Maps</strong>: NIfTI files with region-level
performance metrics (e.g., accuracy, AUC).</li>
<li>
<strong>Prediction Tables</strong>: Text files summarizing
predictions for each region.</li>
<li>
<strong>Configuration File</strong>: <code>config.yaml</code> with
complete analysis parameters for reproducibility.</li>
</ul>
<p>Example directory structure:</p>
<pre><code>regional_results/
├── performance_table.txt   # Regional performance metrics
├── prediction_table.txt    # Prediction details per region
├── regional_metric1.nii    # Regional performance map (e.g., accuracy or AUC)
├── regional_metric2.nii    # Additional metric maps (if applicable)
└── config.yaml             # Analysis configuration</code></pre>
<p>For regression analyses, different metrics (e.g.,
<code>r2.nii</code>, <code>rmse.nii</code>, <code>spearcor.nii</code>)
will be output.</p>
</div>
<div class="section level3">
<h3 id="performance-considerations">9. Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a>
</h3>
<ul>
<li>Use <code>--normalize_samples=TRUE</code> for improved model
performance.</li>
<li>Increase <code>--ncores</code> to leverage multi-core systems.</li>
<li>Adjust parameters based on spatial resolution and hypotheses.</li>
<li>Select appropriate cross-validation strategies to prevent
overfitting.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>MVPA_Regional.R provides comprehensive regional MVPA analysis
capabilities. It handles both volumetric and surface-based data formats
with flexible configuration through command line or config files. The
tool generates detailed performance maps and prediction tables, while
incorporating robust cross-validation and feature selection to ensure
reliable results.</p>
<p><strong>Next Steps:</strong> - Experiment with various models
(<code>--model=rf</code>, <code>--model=sda_notune</code>). - Test
different feature selection methods. - Evaluate both classification and
regression scenarios. - Optimize processing using parallel
computation.</p>
<p>Happy regional analysis!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
